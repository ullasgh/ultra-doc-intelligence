<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Doc-Intelligence</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .upload-section {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: #764ba2;
            background: #f8f9ff;
        }

        .upload-section.drag-over {
            background: #e8ebff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .doc-info {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .doc-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .question-section {
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-field {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .answer-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ebff 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .confidence-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .confidence-high {
            background: #d4edda;
            color: #155724;
        }

        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }

        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }

        .sources {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        .source-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #555;
        }

        .extraction-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .extraction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .extraction-item {
            background: #f8f9ff;
            padding: 12px;
            border-radius: 8px;
        }

        .extraction-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .extraction-value {
            color: #333;
            font-size: 1rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #28a745;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_BASE = 'http://localhost:8000';

        function App() {
            const [docId, setDocId] = useState(null);
            const [docInfo, setDocInfo] = useState(null);
            const [question, setQuestion] = useState('');
            const [answer, setAnswer] = useState(null);
            const [extraction, setExtraction] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(null);
            const [activeTab, setActiveTab] = useState('ask');
            const [dragOver, setDragOver] = useState(false);

            const handleFileUpload = async (file) => {
                if (!file) return;

                setLoading(true);
                setError(null);
                setSuccess(null);

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`${API_BASE}/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) throw new Error('Upload failed');

                    const data = await response.json();
                    setDocId(data.doc_id);
                    setDocInfo(data);
                    setSuccess(`Successfully uploaded ${data.filename} (${data.chunks_created} chunks created)`);
                    setAnswer(null);
                    setExtraction(null);
                } catch (err) {
                    setError('Failed to upload document: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleFileSelect = (e) => {
                handleFileUpload(e.target.files[0]);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                handleFileUpload(e.dataTransfer.files[0]);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = () => {
                setDragOver(false);
            };

            const handleAskQuestion = async () => {
                if (!question.trim() || !docId) return;

                setLoading(true);
                setError(null);

                try {
                    const response = await fetch(`${API_BASE}/ask`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ doc_id: docId, question })
                    });

                    if (!response.ok) throw new Error('Question failed');

                    const data = await response.json();
                    setAnswer(data);
                } catch (err) {
                    setError('Failed to get answer: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleExtract = async () => {
                if (!docId) return;

                setLoading(true);
                setError(null);

                try {
                    const response = await fetch(`${API_BASE}/extract`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ doc_id: docId })
                    });

                    if (!response.ok) throw new Error('Extraction failed');

                    const data = await response.json();
                    setExtraction(data);
                } catch (err) {
                    setError('Failed to extract data: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const getConfidenceClass = (confidence) => {
                if (confidence >= 0.7) return 'confidence-high';
                if (confidence >= 0.4) return 'confidence-medium';
                return 'confidence-low';
            };

            const getConfidenceLabel = (confidence) => {
                if (confidence >= 0.7) return 'High Confidence';
                if (confidence >= 0.4) return 'Medium Confidence';
                return 'Low Confidence';
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>ðŸš› Ultra Doc-Intelligence</h1>
                        <p>AI-Powered Logistics Document Assistant</p>
                    </div>

                    <div className="main-card">
                        {error && <div className="error-message">{error}</div>}
                        {success && <div className="success-message">{success}</div>}

                        <div 
                            className={`upload-section ${dragOver ? 'drag-over' : ''}`}
                            onClick={() => document.getElementById('fileInput').click()}
                            onDrop={handleDrop}
                            onDragOver={handleDragOver}
                            onDragLeave={handleDragLeave}
                        >
                            <div className="upload-icon">ðŸ“„</div>
                            <h2>Upload Logistics Document</h2>
                            <p style={{marginTop: '10px', color: '#666'}}>
                                Click or drag PDF, DOCX, or TXT files here
                            </p>
                            <input 
                                id="fileInput"
                                type="file" 
                                className="file-input"
                                accept=".pdf,.docx,.txt"
                                onChange={handleFileSelect}
                            />
                        </div>

                        {docInfo && (
                            <div className="doc-info">
                                <h3>ðŸ“‹ Document Loaded</h3>
                                <p><strong>File:</strong> {docInfo.filename}</p>
                                <p><strong>Chunks:</strong> {docInfo.chunks_created}</p>
                                <p><strong>Document ID:</strong> {docInfo.doc_id}</p>
                            </div>
                        )}

                        {docId && (
                            <>
                                <div className="tabs">
                                    <button 
                                        className={`tab ${activeTab === 'ask' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('ask')}
                                    >
                                        ðŸ’¬ Ask Questions
                                    </button>
                                    <button 
                                        className={`tab ${activeTab === 'extract' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('extract')}
                                    >
                                        ðŸ“Š Extract Data
                                    </button>
                                </div>

                                {activeTab === 'ask' && (
                                    <div className="question-section">
                                        <div className="input-group">
                                            <input 
                                                type="text"
                                                className="input-field"
                                                placeholder="Ask a question about the document..."
                                                value={question}
                                                onChange={(e) => setQuestion(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && handleAskQuestion()}
                                            />
                                            <button 
                                                className="btn"
                                                onClick={handleAskQuestion}
                                                disabled={loading || !question.trim()}
                                            >
                                                {loading && <span className="loading"></span>}
                                                Ask
                                            </button>
                                        </div>

                                        <div style={{marginBottom: '20px', color: '#666', fontSize: '0.9rem'}}>
                                            <strong>Try asking:</strong>
                                            <div style={{marginTop: '5px'}}>
                                                <span style={{cursor: 'pointer', color: '#667eea', marginRight: '15px'}}
                                                      onClick={() => setQuestion('What is the carrier rate?')}>
                                                    What is the carrier rate?
                                                </span>
                                                <span style={{cursor: 'pointer', color: '#667eea', marginRight: '15px'}}
                                                      onClick={() => setQuestion('When is pickup scheduled?')}>
                                                    When is pickup scheduled?
                                                </span>
                                                <span style={{cursor: 'pointer', color: '#667eea'}}
                                                      onClick={() => setQuestion('Who is the consignee?')}>
                                                    Who is the consignee?
                                                </span>
                                            </div>
                                        </div>

                                        {answer && (
                                            <div className="answer-card">
                                                <span className={`confidence-badge ${getConfidenceClass(answer.confidence)}`}>
                                                    {getConfidenceLabel(answer.confidence)} ({(answer.confidence * 100).toFixed(1)}%)
                                                </span>
                                                <h3 style={{marginBottom: '15px', color: '#333'}}>Answer</h3>
                                                <p style={{fontSize: '1.1rem', lineHeight: '1.6', color: '#444'}}>
                                                    {answer.answer}
                                                </p>
                                                <p style={{marginTop: '15px', fontSize: '0.9rem', color: '#666', fontStyle: 'italic'}}>
                                                    <strong>Reasoning:</strong> {answer.reasoning}
                                                </p>

                                                {answer.sources && answer.sources.length > 0 && (
                                                    <div className="sources">
                                                        <h4 style={{marginBottom: '10px', color: '#667eea'}}>
                                                            ðŸ“š Source Context ({answer.sources.length})
                                                        </h4>
                                                        {answer.sources.map((source, idx) => (
                                                            <div key={idx} className="source-item">
                                                                <strong>Chunk {idx + 1}:</strong> {source}
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'extract' && (
                                    <div>
                                        <button 
                                            className="btn"
                                            onClick={handleExtract}
                                            disabled={loading}
                                        >
                                            {loading && <span className="loading"></span>}
                                            Extract Structured Data
                                        </button>

                                        {extraction && (
                                            <div className="extraction-result" style={{marginTop: '20px'}}>
                                                <h3 style={{color: '#667eea', marginBottom: '10px'}}>
                                                    Extracted Shipment Data
                                                </h3>
                                                <span className={`confidence-badge ${getConfidenceClass(extraction.confidence)}`}>
                                                    Extraction Confidence: {(extraction.confidence * 100).toFixed(1)}%
                                                </span>

                                                <div className="extraction-grid">
                                                    {Object.entries(extraction).map(([key, value]) => {
                                                        if (key === 'confidence') return null;
                                                        return (
                                                            <div key={key} className="extraction-item">
                                                                <div className="extraction-label">
                                                                    {key.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}
                                                                </div>
                                                                <div className="extraction-value">
                                                                    {value || <em style={{color: '#999'}}>Not found</em>}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>

                                                <div style={{marginTop: '20px', padding: '15px', background: '#f8f9ff', borderRadius: '8px'}}>
                                                    <h4 style={{marginBottom: '10px'}}>JSON Output</h4>
                                                    <pre style={{fontSize: '0.85rem', overflow: 'auto'}}>
                                                        {JSON.stringify(extraction, null, 2)}
                                                    </pre>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>